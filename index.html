import turtle
import random
import time
import sys

# --- Cáº¥u hÃ¬nh MÃ n hÃ¬nh ---
screen = turtle.Screen()
screen.setup(width=750, height=900)
screen.bgcolor("black")
screen.title("DÃ nh Táº·ng BÃ­ch ChÄƒm â¤ï¸ - Lá»i ChÃºc TÃ¬nh YÃªu 20s")
screen.tracer(0) 

# --- Háº±ng sá»‘ vÃ  Cáº¥u hÃ¬nh ---
START_TIME = time.time()
DURATION = 20 # Hoáº¡t áº£nh sáº½ cháº¡y trong 20 giÃ¢y
LOI_CHUC_COLORS = ["#FF69B4", "white", "#E77471", "#FFD700", "#ADD8E6"] # Há»“ng, Tráº¯ng, Äá» San HÃ´, VÃ ng, Xanh Nháº¡t
HEART_COLORS = ["red", "pink", "lightcoral", "#FFB6C1", "#DC143C"] # Äá», Há»“ng, Äá» San HÃ´, Há»“ng Nháº¡t, Äá» Tháº«m

# --- Danh sÃ¡ch Lá»i ChÃºc (Vá»›i tÃªn BÃ­ch ChÄƒm) ---
LOI_CHUC = [
    "BÃ­ch ChÄƒm, anh yÃªu em nhiá»u láº¯m! â¤ï¸",
    "MÃ£i mÃ£i lÃ  cá»§a nhau nhÃ©, BÃ­ch ChÄƒm! ğŸ’",
    "ChÃºc BÃ­ch ChÄƒm luÃ´n xinh Ä‘áº¹p & háº¡nh phÃºc! ğŸ˜Š",
    "Em lÃ  nguá»“n sÃ¡ng cá»§a Ä‘á»i anh, BÃ­ch ChÄƒm!",
    "YÃªu em hÆ¡n cáº£ lá»i nÃ³i! ğŸ’–",
    "Gá»­i ngÃ n ná»¥ hÃ´n tá»›i BÃ­ch ChÄƒm! ğŸ˜˜",
    "Cáº£m Æ¡n em Ä‘Ã£ Ä‘áº¿n bÃªn anh, BÃ­ch ChÄƒm!",
    "TÃ¬nh yÃªu cá»§a chÃºng ta lÃ  mÃ£i mÃ£i!",
    "Tháº¿ giá»›i nÃ y tháº­t Ä‘áº¹p vÃ¬ cÃ³ BÃ­ch ChÄƒm!",
    "Má»—i ngÃ y bÃªn em lÃ  má»™t mÃ³n quÃ ! ğŸ",
    "Anh sáº½ luÃ´n náº¯m tay em, BÃ­ch ChÄƒm!",
    "TrÃ¡i tim anh chá»‰ cÃ³ hÃ¬nh bÃ³ng BÃ­ch ChÄƒm!",
    "Háº¡nh phÃºc lÃ  Ä‘Æ°á»£c tháº¥y em cÆ°á»i! ğŸ˜„",
    "BÃ­ch ChÄƒm lÃ  ngÆ°á»i tuyá»‡t vá»i nháº¥t!",
    "TÃ¬nh yÃªu nÃ y lÃ  vÃ´ táº­n! âœ¨"
]

# --- Class Ä‘á»‘i tÆ°á»£ng Lá»i ChÃºc ---
class Lá»iChÃºc:
    def __init__(self, message):
        self.pen = turtle.Turtle()
        self.pen.hideturtle()
        self.pen.color(random.choice(LOI_CHUC_COLORS))
        self.pen.penup()
        
        # Vá»‹ trÃ­ xuáº¥t hiá»‡n ngáº«u nhiÃªn á»Ÿ dÆ°á»›i Ä‘Ã¡y mÃ n hÃ¬nh
        self.x = random.uniform(-screen.window_width()/2 + 150, screen.window_width()/2 - 150)
        self.y = -screen.window_height() / 2 - 50 
        
        self.pen.goto(self.x, self.y)
        self.message = message
        self.speed = random.uniform(1.0, 2.5) 
        self.font_size = random.randint(14, 18)

    def move(self):
        self.y += self.speed
        self.pen.clear()
        self.pen.goto(self.x, self.y)
        self.pen.write(self.message, align="center", font=("Arial", self.font_size, "bold"))

    def is_visible(self):
        return self.y < screen.window_height() / 2 + 50

    def cleanup(self):
        self.pen.clear()
        del self.pen

# --- Class Ä‘á»‘i tÆ°á»£ng TrÃ¡i Tim (Heart) ---
class Tim:
    def __init__(self):
        self.pen = turtle.Turtle()
        self.pen.hideturtle()
        self.pen.shape("circle")
        self.pen.shapesize(random.uniform(0.1, 0.4)) 
        self.pen.color(random.choice(HEART_COLORS))
        self.pen.penup()

        # Vá»‹ trÃ­ xuáº¥t hiá»‡n ngáº«u nhiÃªn á»Ÿ ná»­a dÆ°á»›i mÃ n hÃ¬nh
        self.x = random.uniform(-screen.window_width() / 2, screen.window_width() / 2)
        self.y = random.uniform(-screen.window_height() / 2, -screen.window_height() / 2 + 150) 
        
        self.pen.goto(self.x, self.y)
        self.speed_y = random.uniform(2.5, 4.5) 
        self.speed_x = random.uniform(-1.5, 1.5) 
        self.pen.showturtle()
        self.initial_color = self.pen.color()[0]

    def move(self):
        self.y += self.speed_y
        self.x += self.speed_x
        self.pen.goto(self.x, self.y)
        
        # Hiá»‡u á»©ng láº¥p lÃ¡nh nháº¹
        if random.random() < 0.1: # 10% cÆ¡ há»™i má»—i láº§n cáº­p nháº­t
             self.pen.color("white")
        else:
             self.pen.color(self.initial_color)


    def is_visible(self):
        return self.y < screen.window_height() / 2 + 50

    def cleanup(self):
        self.pen.hideturtle()
        del self.pen

# --- VÃ²ng láº·p chÃ­nh ---
current_messages = []
current_hearts = []
last_message_time = time.time()
last_heart_time = time.time()
message_interval = 2.0 # Lá»i chÃºc xuáº¥t hiá»‡n nhanh hÆ¡n
heart_interval = 0.05  # TrÃ¡i tim xuáº¥t hiá»‡n ráº¥t nhanh vÃ  liÃªn tá»¥c

def create_new_message():
    message = random.choice(LOI_CHUC)
    new_message = Lá»iChÃºc(message)
    current_messages.append(new_message)

def create_new_hearts(count=4):
    for _ in range(count):
        new_heart = Tim()
        current_hearts.append(new_heart)

def animate():
    global last_message_time, last_heart_time
    current_time = time.time()
    elapsed_time = current_time - START_TIME

    # --- Kiá»ƒm tra Ä‘iá»u kiá»‡n káº¿t thÃºc (20 giÃ¢y) ---
    if elapsed_time > DURATION + 2: # Cá»™ng thÃªm 2s Ä‘á»ƒ cÃ¡c Ä‘á»‘i tÆ°á»£ng cuá»‘i ká»‹p bay lÃªn
        # Dá»n dáº¹p táº¥t cáº£ Ä‘á»‘i tÆ°á»£ng cÃ²n láº¡i vÃ  Ä‘Ã³ng chÆ°Æ¡ng trÃ¬nh
        for item in current_messages + current_hearts:
            try:
                item.cleanup()
            except:
                pass
        screen.bye()
        return

    # --- Táº¡o Lá»i ChÃºc má»›i ---
    if current_time - last_message_time > message_interval and elapsed_time < DURATION:
        create_new_message()
        last_message_time = current_time

    # --- Táº¡o TrÃ¡i Tim má»›i (LiÃªn tá»¥c) ---
    if current_time - last_heart_time > heart_interval and elapsed_time < DURATION:
        create_new_hearts(count=random.randint(3, 6)) 
        last_heart_time = current_time

    # --- Di chuyá»ƒn vÃ  XoÃ¡ (Lá»i ChÃºc) ---
    new_messages = []
    for msg in current_messages:
        msg.move()
        if msg.is_visible():
            new_messages.append(msg)
        else:
            msg.cleanup()
    current_messages[:] = new_messages

    # --- Di chuyá»ƒn vÃ  XoÃ¡ (TrÃ¡i Tim) ---
    new_hearts = []
    for heart in current_hearts:
        heart.move()
        if heart.is_visible():
            new_hearts.append(heart)
        else:
            heart.cleanup()
    current_hearts[:] = new_hearts


    screen.update()
    screen.ontimer(animate, 10) # Láº·p láº¡i hoáº¡t áº£nh sau 10ms

# Báº¯t Ä‘áº§u hoáº¡t áº£nh
animate()

# Äá»ƒ chÆ°Æ¡ng trÃ¬nh cháº¡y cho Ä‘áº¿n khi Ä‘Æ°á»£c gá»i screen.bye()
# DÃ¹ng try-except Ä‘á»ƒ trÃ¡nh lá»—i khi ngÆ°á»i dÃ¹ng Ä‘Ã³ng cá»­a sá»•
try:
    screen.mainloop()
except turtle.Terminator:
    print("Hoáº¡t áº£nh Ä‘Ã£ káº¿t thÃºc.")
except Exception as e:
    print(f"CÃ³ lá»—i xáº£y ra: {e}")
